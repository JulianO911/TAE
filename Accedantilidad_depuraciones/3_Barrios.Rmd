---
title: "3_barrios"
author: "Equipo, TAE"
date: "21/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r Paquetes, include = FALSE, warning = FALSE}
library("tidyverse")
library("DT")
library("htmlTable")
```

```{r Base de datos, include = FALSE, warning = FALSE}
load("incidentes.RData")
```


# El problema de los barrios en la base de datos

| En la base de datos de accidentalidad de Medellín entre los años 2014 y 2020, proporcionada por la Secretaría de Tránsito de dicho municipio, se tiene que una de las variables más importantes es la relacionada con el barrio, ya que esta información espacial permite ubicar en un mapa una ubicación de forma orientativa de los accidentes viales que han sucedido. Sin embargo, esto es inicialmente problemático debido a que para esta característica se presentan diversos problemas.

| El primer de ellos es que se desconoce cuál es el tipo de codificación de la base datos, por lo que muchos de los barrios aparecen con nombres extraños en los lugares de los caracteres espaciales del castellano (como por ejemplo: *á*, *é*, *ü* y *ñ*), de manera que se debe comenzar arreglando esto de tal manera que todos los nombres disponibles sean legibles. Asimismo, se tiene que los barrios fueron introducidos en la base de datos de dos formas: una es escribiendo su nombre de pila, como sucede con los barrios *Laureles*, *Moscú* y *Manila*, por ejemplo, pero también de acuerdo con un código numérico de cuatro dígitos, como lo son *0712*, *1015* y *1613*, que corresponden al barrio *Aures No. 2*, *Bomboná No. 1* y *Altavista*, respectivamente. En ese sentido, es necesario corregir los nombres de los barrios que tengan problemas en su codificación o que han sido reportados de acuerdo con su código. Esto se puede ver mejor en la siguiente tabla, en la cual se enlistan a todos los barrios que están registrados en la base de datos de accidentes.

```{r Presentación de barrios}
barriosAux <- accidentes %>% # Vector con todos los barrios de la BD
  select(c(BARRIO))
# barrios <- as.data.frame(barriosAux[!duplicated(barriosAux), ])
barrios <- barriosAux %>% 
  group_by(BARRIO) %>% 
  summarise(Frecuencia = n())

# aux <- nrow(barrios)
# hel <- round(aux/4)

# knitr::kable(
#   list(barrios[1:(hel), ],
#        barrios[(hel+1):(2*hel), ],
#        barrios[(2*hel+1):(3*hel), ],
#        barrios[(3*hel+1):(4*hel), ]),
#   caption = 'Two tables placed side by side.',
#   booktabs = TRUE
# )

datatable(barrios,
          colnames = c("Número de entrada",
                       "Nombre del barrio",
                       "Frecuencia absoluta"))
```

```{r Corrección de códigos}
accidentes <- accidentes %>% 
  mutate(BARRIO = recode(BARRIO,
                         "0103" = "Popular",                              
                          "0105" = "Moscú No. 2",
                          "0109" = "Aldea Pablo VI",                                          
                          "0202" = "Playón de los Comuneros",
                          "0205" = "La Francia",                                          
                          "0208" = "Villa Niza",
                          "0211" = "La Rosa",                                          
                          "0301" = "La Salle",
                          "0302" = "Las Granjas",                                          
                          "0303" = "Campo Valdés No. 2",
                          "0304" = "Santa Inés",                                          
                          "0306" = "El Pomar",
                          "0307" = "Manrique Central No. 2",                                         
                          "0309" = "Versalles No. 1",
                          "0310" = "Versalles No. 2",                                         
                          "0312" = "Oriente",
                          "0402" = "San Isidro",                                         
                          "0408" = "San Pedro",
                          "0409" = "Manrique Central No. 1",                                         
                          "0413" = "Aranjuez",
                          "0505" = "Boyacá",                                         
                          "0509" = "Girardot",
                          "0514" = "Alfonso López",                                        
                          "0606" = "San Martín de Porres",
                          "0711" = "El Diamante",                                         
                          "0712" = "Aures No. 2",
                          "0716" = "Palenque",                                          
                          "0717" = "Robledo",
                          "0803" = "San Miguel",                                         
                          "0809" = "Sucre",
                          "0811" = "Trece de Noviembre",                                          
                          "0813" = "Villatina",
                          "0815" = "Las Estancias",                                         
                          "0819" = "Villa Liliam",
                          "0903" = "Bomboná No. 2",                                         
                          "0906" = "Barrio Caicedo",
                          "0907" = "Buenos Aires",                                          
                          "0912" = "El Salvador",
                          "0914" = "Asomadera No. 1",                                         
                          "1001" = "Prado",
                          "1003" = "Jesús Nazareno",                                         
                          "1004" = "El Chagualo",
                          "1007" = "Guayaquil",                                         
                          "1008" = "Corazón de Jesús",
                          "1011" = "Calle Nueva",                                         
                          "1012" = "Perpetuo Socorro",
                          "1015" = "Bomboná No. 1",                                         
                          "1018" = "Villa Nueva",
                          "1019" = "La Candelaria",                                         
                          "1020" = "San Diego",
                          "1101" = "Carlos E. Restrepo",                                          
                          "1102" = "Suramericana",
                          "1103" = "Naranjal",                                         
                          "1105" = "Los Conquistadores",
                          "1108" = "Laureles",                                          
                          "1114" = "Los Colores",
                          "1202" = "Calasanz",                                          
                          "1204" = "La América",
                          "1205" = "La Floresta",                                         
                          "1206" = "Santa Lucía",
                          "1211" = "Simón Bolívar",                                         
                          "1306" = "La Pradera",
                          "1408" = "Altos del Poblado",                                         
                          "1419" = "Manila",
                          "1422" = "La Aguacatala",                                         
                          "1423" = "Santa María de los Ángeles",
                          "1503" = "Trinidad",                                         
                          "1504" = "Santa Fe",
                          "1507" = "Campo Amor",                                         
                          "1510" = "Guayabal",
                          "1511" = "La Colina",                                         
                          "1603" = "Belén",
                          "1605" = "San Bernardo",                                         
                          "1611" = "Loma de los Bernal",
                          "1612" = "La Gloria",                                         
                          "1613" = "Altavista",
                          "1620" = "El Nogal - Los Almendros",                                         
                          "5002" = "La Frisola",
                          "6001" = "La Loma",                                         
                          "7001" = "Altavista Sector Central",
                          "7002" = "Aguas Frías",                                         
                          "9004" = "Santa Elena",
                          "9086" = "Suburbano El Plan"))
```

```{r}
accidentes <- accidentes %>% 
  mutate(BARRIO = recode(BARRIO,
                         "\\xC1rea de Expansi\\xF3n Altos de Calasanz" = "Área de expansión Altos de Calasanz",
                         "\\xC1rea de Expansi\\xF3n Pajarito" = "Área de expansión Pajarito",
                         "\\xC1rea de Expansi\\xF3n San Antonio de Prado" = "Área de expansión San Antonio de Prado",
                          "Alejandr\\xEDa" = "Alejandría",
                          "Alejandro Echavarr\\xEDa" = "Alejandro Echavarría",
                          "Alfonso L\\xF3pez" = "Alfonso López",
                          "Andaluc\\xEDa" = "Andalucía",
                          "Antonio Nari\\xF1o" = "Antonio Nariño",
                          "Area De Expansion Altavista" = "Área de expansión Altavista",
                          "Área de Expansión Altavista" = "Área de expansión Altavista",                
                          "Area de Expansion Altos de Calasanz" = "Área de expansión Altos de Calasanz",
                          "Área de Expansión Altos de Calasanz" = "Área de expansión Altos de Calasanz",       
                          "Area De Expansion Belen Rincon" = "Área de expansión Belén Rincón",
                          "Área de Expansión Pajarito" = "Área de expansión Pajarito",              
                          "Área de Expansión San Antonio de Prado" = "Área de expansión San Antonio de Prado",                              
                          "Asomadera No.1" = "Asomadera No. 1",
                          "Aguas frias" = "Aguas frías",
                          "Aures No.1" = "Aures No. 1",
                          "Aures No.2" = "Aures No. 2",                                 
                          "B. Cerro  El Volador" = "Barrio Cerro El Volador",                          
                          "B. Cerro El Volador" = "Barrio Cerro El Volador",
                          "Barrio Col\\xF3n" = "Barrio Colón",                                                              
                          "Barrio Crist\\xF3bal" = "Barrio Cristóbal",                           
                          "Barrio de Jes\\xFAs" = "Barrio de Jesús",                               
                          "Barrios de Jesús" = "Barrio de Jesús",
                          "Batall\\xF3n Girardot" = "Batallón Girardot",                        
                          "Bel\\xE9n" = "Belén",                                    
                          "Belalc\\xE1zar" = "Belalcázar",                         
                          "Berl\\xEDn" = "Berlín",
                          "Berlin" = "Berlín",                                        
                          "Bermejal-Los Alamos" = "Bermejal - Los Álamos",                                                              
                          "Bombon\\xE1 No. 1" = "Bomboná No. 1",                             
                          "Bombon\\xE1 No. 2" = "Bomboná No. 2",
                          "Bombon\\xE1 No.1" = "Bomboná No. 1",                             
                          "Bomboná No.1" = "Bomboná No. 1",
                          "Boqueron" = "Boquerón",                
                          "Boyac\\xE1" = "Boyacá",                                     
                          "C\\xF3rdoba" = "Córdoba",                                  
                          "Cabecera Urbana San Cristobal" = "Cabecera Urbana San Cristóbal",                                  
                          "Campo Vald\\xE9s No. 1" = "Campo Valdés No. 1",
                          "Campo Vald\\xE9s No. 2" = "Campo Valdés No. 2",                       
                          "Campo Vald\\xE9s No.2" = "Campo Valdés No. 2",                            
                          "Campo Valdés No.2" = "Campo Valdés No. 2",                                                                              
                          "Catalu\\xF1a" = "Cataluña",                                                                                           
                          "Coraz\\xF3n de Jes\\xFAs" = "Corazón de Jesús",
                          "Diego Echavarr\\xEDa" = "Diego Echavarría",                         
                          "Doce de Octubre No.1" = "Doce de Octubre No. 1",                     
                          "Doce de Octubre No.2" = "Doce de Octubre No. 2",                                  
                          "El Coraz\\xF3n" = "El Corazón",                                
                          "El Corazon El Morro" = "El Corazón - El Morro",                                                           
                          "El Nogal-Los Almendros" = "El Nogal - Los Almendros",                                    
                          "El Progreso No.2" = "El Progreso No. 2",                       
                          "El Rinc\\xF3n" = "El Rincón",                                
                          "El Vel\\xF3dromo" = "El Velódromo",                             
                          "Estaci\\xF3n Villa" = "Estación Villa",                         
                          "F\\xE1tima" = "Fátima",                              
                          "Facultad de Minas U. Nacional" = "Facultad de Minas U. Nacional",
                          "H\\xE9ctor Abad G\\xF3mez" = "Héctor Abad Gómez",                    
                          "Hospital San Vicente de Pa\\xFAl" = "Hospital San Vicente de Paúl",             
                          "Jard\\xEDn Bot\\xE1nico" = "Jardín Botánico",                              
                          "Jes\\xFAs Nazareno" = "Jesús Nazareno",                                 
                          "La Am\\xE9rica" = "La América",
                          "La Mansi\\xF3n" = "La Mansión",
                          "La mota" = "La Mota",                                      
                          "La Pi\\xF1uela" = "La Piñuela",                              
                          "Las Lomas No.1" = "Las Lomas No. 1",                             
                          "Las Lomas No.2" = "Las Lomas No. 2",
                          "Los \\xC1ngeles" = "Los Ángeles",                          
                          "Los Alc\\xE1zares" = "Los Alcázares",
                          "Los Balsos No.1" = "Los Balsos No. 1",
                          "Los Balsos No.2" = "Los Balsos No. 2",                          
                          "Manrique Central No.1" = "Manrique Central No. 1",
                          "Manrique Central No.2" = "Manrique Central No. 2",                       
                          "Mar\\xEDa Cano Carambolas" = "María Cano Carambolas",                    
                          "Mosc\\xFA No. 1" = "Moscú No. 1",                               
                          "Mosc\\xFA No. 2" = "Moscú No. 2",
                          "Mosc\\xFA No.2" = "Moscú No. 2",                              
                          "Moscú No.1" = "Moscú No. 1",                                   
                          "Moscú No.2" = "Moscú No. 2",
                          "Nueva Villa de Aburr\\xE1" = "Nueva Villa de Aburrá",                   
                          "Nueva Villa de la Iguan\\xE1" = "Nueva Villa de la Iguaná",                 
                          "Nueva Villa de La Iguaná" = "Nueva Villa de la Iguaná",                     
                          "Play\\xF3n de Los Comuneros" = "Playón de los Comuneros",                  
                          "San Germ\\xE1n" = "San Germán",                              
                          "San Javier No.1" = "San Javier No. 1",                            
                          "San Javier No.2" = "San Javier No. 2",
                          "San Joaqu\\xEDn" = "San Joaquín",                              
                          "San Jos\\xE9 de la Monta\\xF1a" = "San José de la Montaña",              
                          "San Jos\\xE9 la Cima No. 1" = "San José de la Cima No. 1",
                          "San Jos\\xE9 la Cima No.2" = "San José de la Cima No. 2",                     
                          "San Jose Del Manzanillo" = "San José del Manzanillo",                     
                          "San José la Cima No. 1" = "San José de la Cima No. 1",
                          "San José la Cima No.2" = "San José de la Cima No. 2",                       
                          "San Mart\\xEDn de Porres" = "San Martín de Porres",                     
                          "Santa F\\xE9" = "Santa Fe",                                
                          "Santa Fé" = "Santa Fe",
                          "Santa In\\xE9s" = "Santa Inés",                              
                          "Santa Luc\\xEDa" = "Santa Lucía",
                          "Santa M\\xF3nica" = "Santa Mónica",                              
                          "Santa Mar\\xEDa de los \\xC1ngeles" = "Santa María de los Ángeles",
                          "Santa Mar\\xEDa de Los \\xC1ngeles" = "Santa María de los Ángeles",           
                          "Santa María de Los Ángeles" = "Santa María de los Ángeles",                    
                          "Santo Domingo Savio No.1" = "Santo Domingo Savio No. 1",                                       
                          "Sim\\xF3n Bol\\xEDvar" = "Simón Bólivar",
                          "SUBURB El Plan" = "Suburbano El Plan",                                
                          "Suburbano el Tesoro" = "Suburbano El Tesoro",                           
                          "Suburbano La Palma-El Patio" = "Suburbano La Palma - El Patio",
                          "Suburbano Pedregal alto" = "Suburbano Pedregal Alto",
                          "U.D. Atanasio Girardot" = "Unidad Deportiva Atanasio Girardot",
                          "Versalles No.1" = "Versalles No. 1",                              
                          "Versalles No.2" = "Versalles No. 2",
                          "L\\xF3pez de Mesa" = "López de Mesa",
                          "La Loma De Los Bernal" = "Loma de los Bernal"))
```

```{r}
accidentes$BARRIO[accidentes$BARRIO == "Sin Inf"] <- NA
accidentes$BARRIO[accidentes$BARRIO == "Sin Nombre"] <- NA
accidentes$BARRIO[accidentes$BARRIO == ""] <- NA
accidentes$BARRIO[accidentes$BARRIO == "Inst"] <- NA
accidentes$BARRIO[accidentes$BARRIO == "0"] <- NA
```

Y al hacer las correcciones de codificación, ortográficas y de forma de categorizar los barrios, la tabla de barrios cambia y termina siendo como sigue:

```{r}
barriosAux <- accidentes %>% # Vector con todos los barrios de la BD
  select(c(BARRIO))
barrios <- barriosAux %>% 
  group_by(BARRIO) %>% 
  summarise(Frecuencia = n())

datatable(barrios,
          colnames = c("Número de entrada",
                       "Nombre del barrio",
                       "Frecuencia absoluta"))
```
```{r}
Esp <- accidentes %>% 
  filter(BARRIO == "La Esperanza" | BARRIO == "La Esperanza No. 2")
```



```{r}
save(accidentes, file="incidentes.RData")
```
